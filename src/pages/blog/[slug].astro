---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { readdir, readFile } from 'fs/promises';
import { join } from 'path';
import matter from 'gray-matter';

export async function getStaticPaths() {
  const contentDir = join(process.cwd(), 'src/content/blog');
  const files = await readdir(contentDir);
  const markdownFiles = files.filter(file => file.endsWith('.md'));
  
  const paths = markdownFiles.map(file => ({
    params: { slug: file.replace('.md', '') }
  }));
  
  return paths;
}

const { slug } = Astro.params;

// Read the markdown file
const contentPath = join(process.cwd(), 'src/content/blog', `${slug}.md`);
const fileContent = await readFile(contentPath, 'utf-8');
const { data: frontmatter, content } = matter(fileContent);

// Convert markdown to HTML (basic conversion)
function markdownToHtml(markdown) {
  return markdown
    // Headers
    .replace(/^### (.*$)/gim, '<h3 class="text-xl font-bold mb-4 mt-8 text-accent">$1</h3>')
    .replace(/^## (.*$)/gim, '<h2 class="text-2xl font-bold mb-6 mt-10 text-primary">$1</h2>')
    .replace(/^# (.*$)/gim, '<h1 class="text-3xl font-bold mb-6 mt-8">$1</h1>')
    
    // Bold and italic
    .replace(/\*\*(.*?)\*\*/g, '<strong class="font-bold text-white">$1</strong>')
    .replace(/\*(.*?)\*/g, '<em class="italic">$1</em>')
    
    // Links
    .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" class="text-accent hover:text-accent/80 underline transition-colors">$1</a>')
    
    // Code blocks
    .replace(/```([^`]+)```/gs, '<pre class="bg-slate-700 rounded-lg p-4 my-6 overflow-x-auto"><code class="text-gray-300 text-sm">$1</code></pre>')
    .replace(/`([^`]+)`/g, '<code class="bg-slate-700 px-2 py-1 rounded text-accent text-sm">$1</code>')
    
    // Lists
    .replace(/^\- (.*$)/gim, '<li class="mb-2">$1</li>')
    .replace(/(<li.*<\/li>)/gs, '<ul class="list-disc list-inside mb-6 text-gray-300 space-y-2">$1</ul>')
    
    // Tables
    .replace(/\|([^|\n]+)\|/g, (match, content) => {
      const cells = content.split('|').map(cell => cell.trim()).filter(cell => cell);
      return '<tr>' + cells.map(cell => `<td class="border border-slate-600 px-4 py-2">${cell}</td>`).join('') + '</tr>';
    })
    .replace(/(<tr>.*<\/tr>)/gs, '<table class="w-full border-collapse border border-slate-600 my-6 bg-slate-800 rounded-lg overflow-hidden">$1</table>')
    
    // Paragraphs
    .replace(/^(?!<[h|u|p|t|l])(.*$)/gim, '<p class="mb-6 text-gray-300 leading-relaxed">$1</p>')
    
    // Clean up extra paragraph tags around other elements
    .replace(/<p[^>]*>(<[h|u|t|l][^>]*>.*?<\/[h|u|t|l][^>]*>)<\/p>/gs, '$1')
    .replace(/<p[^>]*>(<pre>.*?<\/pre>)<\/p>/gs, '$1')
    .replace(/<p[^>]*>(<div[^>]*>.*?<\/div>)<\/p>/gs, '$1');
}

const htmlContent = markdownToHtml(content);

const seoTitle = frontmatter.seoTitle || frontmatter.title;
const seoDescription = frontmatter.seoDescription || frontmatter.excerpt;
---

<Layout title={seoTitle} description={seoDescription}>
  <Header />
  
  <!-- Article Hero -->
  <section class="pt-24 pb-12 max-w-4xl mx-auto">
    <div class="container mx-auto px-4">
      <div class="text-center mb-8" data-aos="fade-up">
        <div class="inline-flex items-center gap-2 bg-accent/10 border border-accent/20 rounded-full px-6 py-2 mb-4">
          <span class="text-accent font-semibold">{frontmatter.category}</span>
        </div>
        <h1 class="text-4xl md:text-5xl font-bold mb-6">
          {frontmatter.title.includes(':') ? (
            <>
              {frontmatter.title.split(':')[0]}: <span class="text-accent">{frontmatter.title.split(':')[1]}</span>
            </>
          ) : (
            frontmatter.title
          )}
        </h1>
        <div class="flex items-center justify-center gap-6 text-gray-400 text-sm">
          <span>üìÖ {new Date(frontmatter.publishDate).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</span>
          <span>‚è±Ô∏è {frontmatter.readTime}</span>
          <span>{frontmatter.image} {frontmatter.category}</span>
        </div>
      </div>
      
      <div class="bg-gradient-to-br from-primary/20 to-secondary/20 rounded-2xl p-8 backdrop-blur-sm border border-primary/20 relative overflow-hidden" data-aos="fade-up">
        <div class="absolute top-0 left-0 w-20 h-1 bg-accent"></div>
        <div class="absolute bottom-0 right-0 w-20 h-1 bg-accent"></div>
        
        <p class="text-xl text-gray-300 leading-relaxed">
          {frontmatter.excerpt}
        </p>
      </div>
    </div>
  </section>

  <!-- Article Content -->
  <section class="py-12 max-w-4xl mx-auto">
    <div class="container mx-auto px-4">
      <article class="prose prose-lg max-w-none">
        <div class="blog-content" set:html={htmlContent}></div>
      </article>
    </div>
  </section>

  <!-- Call to Action -->
  <section class="py-20 bg-gradient-to-br from-slate-900 to-slate-800 max-w-4xl mx-auto relative overflow-hidden">
    <!-- Background decorative elements -->
    <div class="absolute inset-0 opacity-10">
      <div class="absolute top-10 left-10 w-32 h-32 bg-accent/30 rounded-full blur-2xl animate-pulse"></div>
      <div class="absolute bottom-10 right-10 w-40 h-40 bg-primary/30 rounded-full blur-2xl animate-pulse" style="animation-delay: 1s"></div>
    </div>
    
    <div class="container mx-auto px-4 relative z-10">
      <div class="max-w-3xl mx-auto text-center" data-aos="fade-up">
        <!-- Category-specific CTA content -->
        {frontmatter.category === 'How-to Guides' ? (
          <>
            <div class="inline-flex items-center gap-2 bg-accent/10 border border-accent/20 rounded-full px-6 py-2 mb-6">
              <span class="text-accent font-semibold">üöÄ Ready to Implement?</span>
            </div>
            <h2 class="text-4xl font-bold mb-6">Need Help Building This Automation?</h2>
            <p class="text-xl text-gray-300 mb-8">
              Skip the trial and error. Our automation experts can implement this solution for you in days, not weeks.
            </p>
          </>
        ) : frontmatter.category === 'Tool Comparisons' ? (
          <>
            <div class="inline-flex items-center gap-2 bg-primary/10 border border-primary/20 rounded-full px-6 py-2 mb-6">
              <span class="text-primary font-semibold">üéØ Make the Right Choice</span>
            </div>
            <h2 class="text-4xl font-bold mb-6">Still Unsure Which Tool is Right for You?</h2>
            <p class="text-xl text-gray-300 mb-8">
              Get a personalized recommendation based on your specific business needs and technical requirements.
            </p>
          </>
        ) : frontmatter.category === 'Industry Insights' ? (
          <>
            <div class="inline-flex items-center gap-2 bg-secondary/10 border border-secondary/20 rounded-full px-6 py-2 mb-6">
              <span class="text-secondary font-semibold">üí° Ready to Transform?</span>
            </div>
            <h2 class="text-4xl font-bold mb-6">Turn These Insights Into Action</h2>
            <p class="text-xl text-gray-300 mb-8">
              Get a custom automation strategy designed specifically for your industry and business model.
            </p>
          </>
        ) : frontmatter.category === 'Marketing Automation' ? (
          <>
            <div class="inline-flex items-center gap-2 bg-accent/10 border border-accent/20 rounded-full px-6 py-2 mb-6">
              <span class="text-accent font-semibold">üìà Boost Your Marketing</span>
            </div>
            <h2 class="text-4xl font-bold mb-6">Ready to Automate Your Marketing?</h2>
            <p class="text-xl text-gray-300 mb-8">
              Let our experts build these marketing automations for you and start seeing results in weeks, not months.
            </p>
          </>
        ) : (
          <>
            <div class="inline-flex items-center gap-2 bg-accent/10 border border-accent/20 rounded-full px-6 py-2 mb-6">
              <span class="text-accent font-semibold">üî• Take Action Now</span>
            </div>
            <h2 class="text-4xl font-bold mb-6">Ready to Implement These Strategies?</h2>
            <p class="text-xl text-gray-300 mb-8">
              Get expert help implementing the automation solutions discussed in this article.
            </p>
          </>
        )}
        
        <!-- CTA Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 justify-center mb-8">
          <a
            href="/contact"
            class="bg-gradient-to-r from-accent to-accent/80 hover:from-accent/80 hover:to-accent px-8 py-4 rounded-lg font-semibold transition-all transform hover:scale-105 text-white text-lg shadow-lg hover:shadow-xl"
          >
            Get Expert Consultation
          </a>
          <a
            href="/case-studies"
            class="border border-primary text-primary hover:bg-primary hover:text-white px-8 py-4 rounded-lg font-semibold transition-all text-lg hover:shadow-lg"
          >
            View Implementation Examples
          </a>
        </div>
        
        <!-- Social proof -->
        <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
          <div class="flex items-center justify-center gap-8 text-sm text-gray-400">
            <div class="flex items-center gap-2">
              <span class="text-accent">‚úì</span>
              <span>Free 30-min consultation</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-accent">‚úì</span>
              <span>Custom automation strategy</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-accent">‚úì</span>
              <span>No commitment required</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Related Articles -->
  <section class="py-20 max-w-4xl mx-auto">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold text-center mb-12" data-aos="fade-up">More Automation Insights</h2>
      
      <div class="grid md:grid-cols-2 gap-8">
        <div class="bg-slate-800 rounded-xl p-6 border-l-4 border-primary" data-aos="fade-up">
          <div class="text-2xl mb-4">üìö</div>
          <h3 class="text-xl font-bold mb-3">
            <a href="/blog" class="hover:text-primary transition-colors">Browse All Articles</a>
          </h3>
          <p class="text-gray-400 text-sm mb-4">
            Discover more automation tutorials, tool comparisons, and industry insights.
          </p>
          <a href="/blog" class="text-primary hover:text-primary/80 font-semibold text-sm transition-colors">
            View Blog ‚Üí
          </a>
        </div>
        
        <div class="bg-slate-800 rounded-xl p-6 border-l-4 border-accent" data-aos="fade-up">
          <div class="text-2xl mb-4">üéØ</div>
          <h3 class="text-xl font-bold mb-3">
            <a href="/services" class="hover:text-accent transition-colors">Our Services</a>
          </h3>
          <p class="text-gray-400 text-sm mb-4">
            Professional automation implementation and consulting services.
          </p>
          <a href="/services" class="text-accent hover:text-accent/80 font-semibold text-sm transition-colors">
            Learn More ‚Üí
          </a>
        </div>
      </div>
    </div>
  </section>

  <Footer />
</Layout>

<style>
  .blog-content {
    color: #e2e8f0;
    line-height: 1.7;
  }
  
  .blog-content h1,
  .blog-content h2,
  .blog-content h3,
  .blog-content h4 {
    margin-top: 2rem;
    margin-bottom: 1rem;
    font-weight: bold;
  }
  
  .blog-content h2 {
    color: #3b82f6;
    font-size: 1.75rem;
    border-bottom: 2px solid #ff641e;
    padding-bottom: 0.5rem;
  }
  
  .blog-content h3 {
    color: #ff641e;
    font-size: 1.25rem;
  }
  
  .blog-content p {
    margin-bottom: 1.5rem;
    color: #cbd5e1;
  }
  
  .blog-content ul,
  .blog-content ol {
    margin: 1.5rem 0;
    padding-left: 1.5rem;
  }
  
  .blog-content ul {
    list-style-type: disc;
  }
  
  .blog-content li {
    margin-bottom: 0.5rem;
    color: #cbd5e1;
  }
  
  .blog-content strong {
    color: #f8fafc;
    font-weight: 600;
  }
  
  .blog-content code {
    background-color: #374151;
    color: #ff641e;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.875rem;
  }
  
  .blog-content pre {
    background-color: #374151;
    padding: 1.5rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin: 1.5rem 0;
  }
  
  .blog-content pre code {
    background: none;
    color: #d1d5db;
    padding: 0;
  }
  
  .blog-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5rem 0;
    background-color: #1e293b;
    border-radius: 0.5rem;
    overflow: hidden;
  }
  
  .blog-content th,
  .blog-content td {
    border: 1px solid #475569;
    padding: 0.75rem 1rem;
    text-align: left;
  }
  
  .blog-content th {
    background-color: #334155;
    font-weight: 600;
    color: #ff641e;
  }
  
  .blog-content a {
    color: #ff641e;
    text-decoration: underline;
  }
  
  .blog-content a:hover {
    color: #e55a1a;
  }
  
  .blog-content blockquote {
    border-left: 4px solid #ff641e;
    background-color: #1e293b;
    padding: 1rem 1.5rem;
    margin: 1.5rem 0;
    border-radius: 0.375rem;
  }
</style> 
